<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Locations Map</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        #map { height: 80vh; width: 100%; }
        #actionBtn {
            position: absolute;
            top: 20px; left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            padding: 10px 20px;
            font-size: 1rem;
        }
    </style>
</head>
<body>

<button id="actionBtn">Refresh Markers</button>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Initialise map (centered on the world)
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const markerLayer = L.layerGroup().addTo(map);

    async function loadMarkers() {
        markerLayer.clearLayers();
        const resp = await fetch('/api/locations');
        const data = await resp.json();

        data.forEach(loc => {
            const marker = L.marker([loc.latitude, loc.longitude])
                .addTo(markerLayer)
                .bindPopup(`<b>${loc.region}</b><br>Lat: ${loc.latitude}<br>Lng: ${loc.longitude}`);
        });

        // Auto-zoom to fit all markers
        if (data.length) {
            const bounds = markerLayer.getBounds();
            map.fitBounds(bounds.pad(0.2));
        }
    }

    // Initial load
    loadMarkers();

    // Button refreshes the markers
    document.getElementById('actionBtn').addEventListener('click', loadMarkers);
</script>
</body>
</html>